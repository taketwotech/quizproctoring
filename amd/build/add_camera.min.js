define ("quizaccess_quizproctoring/add_camera",["jquery","core/str","core/modal_factory"],function(a,b,c){var d=function(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,e=a(document);this.video=document.getElementById(this.videoid);this.canvas=document.getElementById(this.canvasid);this.cmid=b;this.mainimage=c;this.attemptid=d;e.on("popup",this.showpopup.bind(this));setTimeout(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){if(this.video){this.video.srcObject=a;this.video.play()}}).catch(function(){}),1e4)};d.prototype.video=!1;d.prototype.videoid="video";d.prototype.canvas=!1;d.prototype.canvasid="canvas";d.prototype.width=320;d.prototype.height=240;d.prototype.takepictureid="takepicture";d.prototype.retakeid="retake";d.prototype.cmid=!1;d.prototype.mainimage=!1;d.prototype.attemptid=!1;d.prototype.takepicture=function(){var b=this.canvas.getContext("2d");b.drawImage(this.video,0,0,this.width,this.height);var c=this.canvas.toDataURL("image/png");a("#"+this.videoid).hide();a("#"+this.takepictureid).hide();a("#"+this.canvasid).show();a("#"+this.retakeid).show();a("input[name='userimg']").val(c);a("#id_submitbutton").prop("disabled",!0);a.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/ajax.php",method:"POST",data:{imgBase64:c,cmid:this.cmid,attemptid:this.attemptid,mainimage:this.mainimage},success:function success(b){if(b&&b.errorcode){a("input[name='userimg']").val("");a(document).trigger("popup",b.error)}else{a("#id_submitbutton").prop("disabled",!1)}}})};d.prototype.proctoringimage=function(){var b=this.canvas.getContext("2d");b.drawImage(this.video,0,0,this.width,this.height);var c=this.canvas.toDataURL("image/png");a.ajax({url:M.cfg.wwwroot+"/mod/quiz/accessrule/quizproctoring/ajax.php",method:"POST",data:{imgBase64:c,cmid:this.cmid,attemptid:this.attemptid,mainimage:this.mainimage},success:function success(b){if(b&&b.errorcode){a(document).trigger("popup",b.error)}else{if(b.redirect&&b.url){window.onbeforeunload=null;window.location.href=encodeURI(b.url)}}}})};d.prototype.retake=function(){a("input[name='userimg']").val("");a("#"+this.videoid).show(this.cmid);a("#"+this.takepictureid).show();a("#"+this.canvasid).hide();a("#"+this.retakeid).hide()};d.prototype.showpopup=function(a,b){c.create({body:b}).then(function(a){a.show()})};return{init:function init(e,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null,i=4<arguments.length&&arguments[4]!==void 0?arguments[4]:300;if(g){a("<canvas>").attr({id:"canvas",width:"280",height:"240",style:"display: none;"}).appendTo("body");a("<video>").attr({id:"video",width:"280",height:"240",autoplay:"autoplay"}).appendTo("body");var j=new d(e,f,h);setInterval(j.proctoringimage.bind(j),1e3*i)}else{var j=new d(e,f,h);a("#"+j.takepictureid).on("click",function(a){a.preventDefault();j.takepicture()});a("#"+j.retakeid).on("click",function(a){a.preventDefault();j.retake()});a("#id_submitbutton").on("click",function(d){if(""==a("input[name='userimg']").val()){d.preventDefault();c.create({body:b.get_string("clickpicture","quizaccess_quizproctoring")}).then(function(a){a.show()})}})}}}});
//# sourceMappingURL=add_camera.min.js.map
